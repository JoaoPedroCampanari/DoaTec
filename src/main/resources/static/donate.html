<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quero Doar - Plataforma de Doação</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
<header>
    <nav class="navbar">
        <div class="logo"><img src="doatec_logo.png" width="215" alt="Logo DoaTec"></div>
        <ul class="nav-links">
            <li><a href="index.html" class="active">Início</a></li>
            <li><a href="donate.html">Quero Doar</a></li>
            <li><a href="aluno.html">Preciso de um Computador</a></li>
            <li><a href="suporte.html">Suporte</a></li>
            <li><a href="sobre.html">Sobre Nós</a></li>
        </ul>
        <div class="menu-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>
</header>

<main>
    <section class="application-section">
        <div class="container">
            <div class="application-header">
                <h1>Formulário de Doação</h1>
                <p>Agradecemos seu interesse em ajudar! Pessoas físicas e jurídicas podem doar equipamentos completos ou componentes que serão usados para montar computadores para estudantes.</p>
            </div>
            <form id="donationForm" class="application-form">
                <fieldset>
                    <legend>Informações do Doador</legend>
                    <div class="form-group">
                        <label for="donorName">Seu Nome ou Nome da Empresa:</label>
                        <input type="text" id="donorName" name="donorName" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Doador:</label>
                        <div>
                            <input type="radio" id="typeCpf" name="documentType" value="cpf" checked>
                            <label for="typeCpf" class="radio-label">Pessoa Física (CPF)</label>
                        </div>
                        <div>
                            <input type="radio" id="typeCnpj" name="documentType" value="cnpj">
                            <label for="typeCnpj" class="checkbox-label">Pessoa Jurídica (CNPJ)</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="documentNumber" id="documentLabel">CPF:</label>
                        <input type="text" id="documentNumber" name="documentNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email para Contato*:</label>
                        <input type="email" id="email" name="email" required>
                        <small class="form-text">Usaremos este email para coordenar a coleta/entrega da sua doação.</small>
                    </div>
                    <div class="form-group">
                        <label for="phone">Telefone (Opcional):</label>
                        <input type="tel" id="phone" name="phone" placeholder="(XX) XXXXX-XXXX">
                        <small class="form-text">Ajuda a agilizar o contato, se necessário.</small>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Detalhes da Doação</legend>
                    <div class="form-group">
                        <label>O que você gostaria de doar?</label>
                        <div>
                            <input type="radio" id="itemDesktop" name="donatedItems" value="desktop">
                            <label for="itemDesktop" class="checkbox-label">Computador de Mesa (Desktop)</label>
                        </div>
                        <div>
                            <input type="radio" id="itemNotebook" name="donatedItems" value="notebook">
                            <label for="itemNotebook" class="checkbox-label">Notebook</label>
                        </div>
                        <div>
                            <input type="radio" id="itemComponents" name="donatedItems" value="components">
                            <label for="itemComponents" class="checkbox-label">Peças e Componentes Avulsos</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="itemDescription">Descrição dos Itens:</label>
                        <textarea id="itemDescription" name="itemDescription" rows="5" required></textarea>
                        <small class="form-text">Por favor, liste os itens que deseja doar e, se possível, seu estado de conservação (ex: "Notebook Dell, funcionando, mas sem bateria", "2x pentes de memória RAM DDR3 4GB").</small>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Logística</legend>
                    <div class="form-group">
                        <label>Como prefere realizar a entrega?</label>
                        <div>
                            <input type="radio" id="deliveryDropoff" name="deliveryPreference" value="PONTO_DE_COLETA" checked>
                            <label for="deliveryDropoff" class="radio-label">Posso levar até um ponto de coleta em Garça</label>
                        </div>
                        <div>
                            <input type="radio" id="deliveryPickup" name="deliveryPreference" value="SOLICITAR_RETIRADA">
                            <label for="deliveryPickup" class="checkbox-label">Gostaria de solicitar a retirada no meu endereço (sujeito a análise de viabilidade)</label>
                        </div>
                    </div>
                </fieldset>
                <div class="form-group">
                    <input type="checkbox" id="terms" name="terms" required>
                    <label for="terms" class="checkbox-label">Declaro que os itens doados são de minha propriedade e concordo em transferi-los para o projeto.</label>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Enviar Formulário de Doação</button>
            </form>
        </div>
    </section>
</main>
<footer>
    <div class="container">
        <p>&copy; 2025 Plataforma de Doação - Fatec Garça. Todos os direitos reservados.</p>
    </div>
</footer>
<script>
    // Adiciona um "ouvinte" que espera toda a página HTML ser carregada antes de executar o script.
    document.addEventListener('DOMContentLoaded', function() {

        // --- Lógica para atualizar dinamicamente o campo de documento (CPF/CNPJ) ---
        const radioCpf = document.getElementById('typeCpf');
        const radioCnpj = document.getElementById('typeCnpj');
        const documentLabel = document.getElementById('documentLabel');
        const documentInput = document.getElementById('documentNumber');

        // Função que muda o texto do label e o placeholder do input com base na seleção.
        function updateDocumentField() {
            if (radioCpf.checked) {
                documentLabel.textContent = 'CPF:';
                documentInput.placeholder = 'Digite seu CPF (apenas números)';
            } else {
                documentLabel.textContent = 'CNPJ:';
                documentInput.placeholder = 'Digite seu CNPJ (apenas números)';
            }
        }
        // Adiciona "ouvintes" para o evento de mudança nos botões de rádio.
        radioCpf.addEventListener('change', updateDocumentField);
        radioCnpj.addEventListener('change', updateDocumentField);
        // Chama a função uma vez no início para definir o estado inicial correto.
        updateDocumentField();

        // --- Lógica para o envio do formulário ---
        // Encontra o formulário de doação no HTML pelo seu ID.
        const donationForm = document.getElementById('donationForm');

        // Adiciona um "ouvinte" para o evento de 'submit' (envio) do formulário.
        donationForm.addEventListener('submit', async (event) => {
            // Impede o comportamento padrão do formulário, que é recarregar a página.
            event.preventDefault();

            // Coleta os valores de todos os campos do formulário.
            const nome = document.getElementById('donorName').value;
            const tipoDocumento = document.querySelector('input[name="documentType"]:checked').value;
            const numeroDocumento = document.getElementById('documentNumber').value;
            const email = document.getElementById('email').value;
            const telefone = document.getElementById('phone').value;
            const selectedDonatedItem = document.querySelector('input[name="donatedItems"]:checked');
            const tipoItem = selectedDonatedItem ? selectedDonatedItem.value : '';
            const descricaoItem = document.getElementById('itemDescription').value;
            const preferenciaEntrega = document.querySelector('input[name="deliveryPreference"]:checked').value;
            const termsAccepted = document.getElementById('terms').checked;

            // Validação: verifica se os termos foram aceitos.
            if (!termsAccepted) {
                alert('Você deve concordar com os termos da doação.');
                return; // Interrompe o envio do formulário.
            }
            // Validação: verifica se um tipo de item foi selecionado.
            if (!tipoItem) {
                alert('Por favor, selecione o que você gostaria de doar.');
                return; // Interrompe o envio do formulário.
            }

            // Monta o objeto com os dados da doação para ser enviado como JSON.
            const doacaoData = {
                nome: nome,
                tipoDocumento: tipoDocumento,
                numeroDocumento: numeroDocumento,
                email: email,
                telefone: telefone,
                tipoItem: tipoItem,
                descricaoItem: descricaoItem,
                preferenciaEntrega: preferenciaEntrega
            };

            // Tenta enviar os dados para a API do backend.
            try {
                const response = await fetch('/api/donations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(doacaoData)
                });

                // Se a resposta for bem-sucedida, executa o bloco if.
                if (response.ok) {
                    const message = await response.text();
                    alert(message);
                    // Limpa o formulário após o sucesso.
                    donationForm.reset();
                } else {
                    // Se houver um erro, pega a mensagem de erro do backend.
                    const errorData = await response.text();
                    alert('Erro ao registrar doação: ' + errorData);
                }
            } catch (error) {
                // Se ocorrer um erro de rede, exibe um alerta e loga o erro no console.
                console.error('Erro na requisição de doação:', error);
                alert('Ocorreu um erro ao enviar sua doação. Verifique a conexão com o servidor.');
            }
        });
    });
</script>
</body>

</html>